<!DOCTYPE html>
<html>
<head>
  <title>Centripetal Force Car Game</title>
  <style>
    body { margin:0; overflow:hidden; background:#222; color:#fff; font-family:Arial; }
    canvas { display:block; background:#333; }
    #info { position:absolute; top:10px; left:10px; font-size:18px; }
    .overlay {
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.85);
      display:flex; justify-content:center; align-items:center; flex-direction:column;
      color:#fff; font-size:20px; text-align:center; padding:20px; z-index:10;
    }
    button { margin-top:20px; padding:10px 20px; font-size:18px; cursor:pointer; }
  </style>
</head>
<body>
  <!-- Start Popup -->
  <div id="startOverlay" class="overlay">
    <h1>Rotational Motion Car Game</h1>
    <p>Rules:</p>
    <ul>
      <li>Press and hold <b>Up arrow</b> to move the car along the circular track.</li>
      <li>If you release the Up arrow after starting, the car falls off (game over).</li>
      <li>Complete one full circle to win.</li>
      <li>The arrow shows the centripetal force direction toward the center.</li>
    </ul>
    <button onclick="startCountdown()">Start Game</button>
  </div>

  <!-- Game Over / Win Popup -->
  <div id="endOverlay" class="overlay" style="display:none;">
    <h1 id="endTitle">Game Over!</h1>
    <p id="endMessage"></p>
    <button onclick="restartGame()">Play Again</button>
  </div>

  <div id="info">Speed: 0 | Angle: 0° | Centripetal Force: 0 N</div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const radius = 150;
    const carMass = 1;

    let car = { angle: 0, speed: 0.05 };
    const keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    let gameRunning = false;
    let countdownActive = false;
    let hasStartedMoving = false; // Track if player pressed Up arrow to start movement

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Track
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI*2);
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 4;
      ctx.stroke();
      ctx.closePath();

      // Car position
      const carX = centerX + radius * Math.cos(car.angle);
      const carY = centerY + radius * Math.sin(car.angle);

      // Car
      ctx.fillStyle = 'red';
      ctx.beginPath();
      ctx.arc(carX, carY, 15, 0, Math.PI*2);
      ctx.fill();
      ctx.closePath();

      // Centripetal force arrow
      const arrowLength = 50;
      ctx.strokeStyle = 'yellow';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(carX, carY);
      ctx.lineTo(carX + (centerX - carX) * 0.3, carY + (centerY - carY) * 0.3);
      ctx.stroke();
      ctx.closePath();

      // Arrowhead
      const headSize = 10;
      const angle = Math.atan2(centerY - carY, centerX - carX);
      ctx.beginPath();
      ctx.moveTo(carX + (centerX - carX) * 0.3, carY + (centerY - carY) * 0.3);
      ctx.lineTo(carX + (centerX - carX) * 0.3 - headSize * Math.cos(angle - Math.PI/6),
                 carY + (centerY - carY) * 0.3 - headSize * Math.sin(angle - Math.PI/6));
      ctx.lineTo(carX + (centerX - carX) * 0.3 - headSize * Math.cos(angle + Math.PI/6),
                 carY + (centerY - carY) * 0.3 - headSize * Math.sin(angle + Math.PI/6));
      ctx.lineTo(carX + (centerX - carX) * 0.3, carY + (centerY - carY) * 0.3);
      ctx.fillStyle = 'yellow';
      ctx.fill();
      ctx.closePath();
    }

    function update() {
      if(!gameRunning || countdownActive) return;

      if(keys['ArrowUp']){
        car.angle += car.speed;
        hasStartedMoving = true; // Player started moving
      } else if(hasStartedMoving){
        // Only trigger game over if player already started moving
        gameRunning = false;
        document.getElementById('endOverlay').style.display = 'flex';
        document.getElementById('endTitle').innerText = "Game Over!";
        document.getElementById('endMessage').innerHTML =
          `You released the Up arrow and lost centripetal force.<br><br>
           Physics Explanation:<br>
           The car needs centripetal force to stay on the track: F = m*v²/r.<br>
           Releasing the key removes the required force and the car falls off.`;
      }

      // Physics calculation
      const centripetalAcc = car.speed*car.speed*radius;
      const centripetalForce = carMass * centripetalAcc;

      document.getElementById('info').innerText =
        `Speed: ${car.speed.toFixed(2)} rad/frame | Angle: ${(car.angle*180/Math.PI).toFixed(0)}° | Centripetal Force: ${centripetalForce.toFixed(2)} N`;

      // Win condition
      if(car.angle >= 2*Math.PI){
        gameRunning = false;
        document.getElementById('endOverlay').style.display = 'flex';
        document.getElementById('endTitle').innerText = "You Win!";
        document.getElementById('endMessage').innerHTML =
          `Congratulations! You completed one full circle.<br><br>
           Physics Explanation:<br>
           Holding the Up arrow maintained sufficient centripetal force to stay in circular motion.`;
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    function startCountdown() {
      let count = 3;
      countdownActive = true;
      document.getElementById('startOverlay').innerHTML = `<h1>Starting in ${count}</h1>`;
      const interval = setInterval(() => {
        count--;
        if(count > 0){
          document.getElementById('startOverlay').innerHTML = `<h1>Starting in ${count}</h1>`;
        } else {
          clearInterval(interval);
          document.getElementById('startOverlay').style.display = 'none';
          countdownActive = false;
          startGame();
        }
      }, 1000);
    }

    function startGame() {
      car.angle = 0;
      car.speed = 0.05;
      hasStartedMoving = false; // reset
      gameRunning = true;
    }

    function restartGame() {
      document.getElementById('endOverlay').style.display = 'none';
      document.getElementById('startOverlay').style.display = 'flex';
      document.getElementById('startOverlay').innerHTML = `
        <h1>Rotational Motion Car Game</h1>
        <p>Rules:</p>
        <ul>
          <li>Press and hold <b>Up arrow</b> to move the car along the circular track.</li>
          <li>If you release the Up arrow after starting, the car falls off (game over).</li>
          <li>Complete one full circle to win.</li>
          <li>The arrow shows the centripetal force direction toward the center.</li>
        </ul>
        <button onclick="startCountdown()">Start Game</button>
      `;
    }

    loop();
  </script>
</body>
</html>
