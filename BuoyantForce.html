<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buoyant Balloon Adventure - Educational Version</title>
<style>
  body { margin: 0; overflow: hidden; font-family: Arial; }
  canvas { display: block; }

  .modal {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7);
    display: flex; justify-content: center; align-items: center;
    color: white; text-align: center; padding: 20px; z-index: 10;
  }

  .modal-content {
    background: #1E90FF;
    padding: 20px;
    border-radius: 10px;
    max-width: 500px;
  }

  .btn {
    margin-top: 15px;
    padding: 10px 20px;
    background: #FFD700;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }

  #scoreboard {
    position: absolute; top: 10px; left: 10px;
    color: white; font-size: 20px;
    background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;
  }
</style>
</head>
<body>

<div id="startupModal" class="modal">
  <div class="modal-content">
    <h2>Welcome to Buoyant Balloon Adventure!</h2>
    <p>Rules:</p>
    <ul>
      <li>Press <b>Spacebar</b> to make your balloon rise.</li>
      <li>Dodge colorful obstacles.</li>
      <li>Collect stars for bonus points.</li>
      <li>Each level increases difficulty.</li>
    </ul>
    <button class="btn" id="startBtn">Start Game</button>
  </div>
</div>

<div id="scoreboard">Score: 0 | Level: 1</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>

// Scene & Camera
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,0,15);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,10,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// Floor
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(50,1),
  new THREE.MeshStandardMaterial({color:0x228B22})
);
floor.position.y = -7;
scene.add(floor);

// Balloon (Player)
const balloonGeometry = new THREE.SphereGeometry(1,32,32);
const balloonMaterial = new THREE.MeshStandardMaterial({color:0xff69b4});
const balloon = new THREE.Mesh(balloonGeometry, balloonMaterial);
balloon.position.y = 0;
scene.add(balloon);

// Bubble particles
const bubbles = [];
function createBubble(x,y){
  const geometry = new THREE.SphereGeometry(Math.random()*0.1+0.05,8,8);
  const material = new THREE.MeshStandardMaterial({color:0xADD8E6,transparent:true,opacity:Math.random()*0.5+0.3});
  const bubble = new THREE.Mesh(geometry, material);
  bubble.position.set(x,y,0);
  scene.add(bubble);
  bubbles.push(bubble);
}

// Obstacles
const obstacles = [];
function createObstacle(x,y,width,height,color){
  const geometry = new THREE.BoxGeometry(width,height,1);
  const material = new THREE.MeshStandardMaterial({color:color});
  const obs = new THREE.Mesh(geometry, material);
  obs.position.set(x,y,0);
  scene.add(obs);
  obstacles.push(obs);
}

// Initial Obstacles
for(let i=0;i<6;i++){
  createObstacle(10 + i*10, (Math.random()*8)-4, 2, Math.random()*4+2, Math.random()*0xffffff);
}

// Stars (Collectibles)
const stars = [];
function createStar(x,y){
  const geometry = new THREE.OctahedronGeometry(0.4);
  const material = new THREE.MeshStandardMaterial({color:0xffff00});
  const star = new THREE.Mesh(geometry,material);
  star.position.set(x,y,0);
  scene.add(star);
  stars.push(star);
}
for(let i=0;i<3;i++){
  createStar(12 + i*8, (Math.random()*8)-4);
}

// Physics
let velocity = 0;
const gravity = -0.015;
const buoyancy = 0.012;
const tapImpulse = 0.25;
const damping = 0.98;

// Score & Level
let score = 0;
let level = 1;
let obstacleSpeed = 0.06;
const scoreboard = document.getElementById("scoreboard");

// Sounds
const popSound = new Audio("https://freesound.org/data/previews/522/522314_10226580-lq.mp3");
const tapSound = new Audio("https://freesound.org/data/previews/271/271362_5121236-lq.mp3");
const starSound = new Audio("https://freesound.org/data/previews/341/341695_6266160-lq.mp3");

// Game control
let gameStarted = false;

function animate(){
  if(!gameStarted) return;
  requestAnimationFrame(animate);

  // Physics
  velocity += gravity + buoyancy;
  velocity *= damping;
  balloon.position.y += velocity;

  if(balloon.position.y > 6){ balloon.position.y=6; velocity=Math.min(velocity,0);}
  if(balloon.position.y < -6){ balloon.position.y=-6; velocity=Math.max(velocity,0);}

  // Bubbles
  createBubble(balloon.position.x-0.5, balloon.position.y);
  bubbles.forEach((b,i)=>{
    b.position.y += 0.05 + Math.random()*0.02;
    b.position.x += (Math.random()-0.5)*0.01;
    b.material.opacity -= 0.01;
    if(b.material.opacity <=0){ scene.remove(b); bubbles.splice(i,1);}
  });

  // Obstacles
  obstacles.forEach((obs,i)=>{
    obs.position.x -= obstacleSpeed;
    if(obs.position.x < -15){
      obs.position.x = 25;
      obs.position.y = (Math.random()*8)-4;
      obs.geometry.parameters.height = Math.random()*4+2;
      obs.material.color.setHex(Math.random()*0xffffff);
      score++;
      if(score%5===0){ level++; obstacleSpeed += 0.01;}
    }
    const dx = balloon.position.x - obs.position.x;
    const dy = balloon.position.y - obs.position.y;
    if(Math.abs(dx)<1+obs.geometry.parameters.width/2 && Math.abs(dy)<1+obs.geometry.parameters.height/2){
      popSound.play();
      gameOver();
    }
  });

  // Stars
  stars.forEach((star,i)=>{
    star.position.x -= obstacleSpeed;
    if(star.position.x < -15){
      star.position.x = 25;
      star.position.y = (Math.random()*8)-4;
    }
    const dx = balloon.position.x - star.position.x;
    const dy = balloon.position.y - star.position.y;
    if(Math.abs(dx)<1 && Math.abs(dy)<1){
      score +=3;
      starSound.play();
      scene.remove(star);
      stars.splice(i,1);
      createStar(25, (Math.random()*8)-4);
    }
  });

  scoreboard.innerHTML = `Score: ${score} | Level: ${level}`;

  renderer.render(scene,camera);
}

// Spacebar control
window.addEventListener("keydown",(event)=>{
  if(event.code==="Space" && gameStarted){
    velocity += tapImpulse;
    tapSound.play();
    event.preventDefault();
  }
});

// Start button
document.getElementById("startBtn").addEventListener("click", ()=>{
  document.getElementById("startupModal").style.display = "none";
  gameStarted = true;
  animate();
});

// Game over popup
function gameOver(){
  gameStarted=false;
  const modal = document.createElement("div");
  modal.className="modal";
  modal.innerHTML = `<div class="modal-content">
    <h2>Game Over!</h2>
    <p>Your Score: ${score}</p>
    <p>Buoyant Force Explanation:</p>
    <p>Buoyant force is the upward force a fluid (like water or air) exerts on an object. 
    In this game, your balloon floats because the buoyant force pushes it upward against gravity!</p>
    <button class="btn" onclick="location.reload()">Play Again</button>
  </div>`;
  document.body.appendChild(modal);
}
</script>
</body>
</html>
